{% extends 'challenges/base.html' %}

{% block title %}ChallengeHub - –ü—Ä–æ—Ñ–∏–ª—å{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1>üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
        <p class="text-muted">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}!</p>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h5>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label for="id_username" class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" name="username" value="{{ user.username }}" class="form-control" id="id_username" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="id_email" class="form-label">Email</label>
                        <input type="email" name="email" value="{{ user.email|default:'' }}" class="form-control" id="id_email">
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="card">
            <div class="card-body">
                <h6>üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h6>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span>–í—Å–µ–≥–æ —á–µ–ª–ª–µ–Ω–¥–∂–µ–π:</span>
                        <span class="badge bg-primary rounded-pill">{{ user_challenges.count }}</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span>–ê–∫—Ç–∏–≤–Ω—ã—Ö:</span>
                        <span class="badge bg-success rounded-pill">{{ active_challenges }}</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span>–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö:</span>
                        <span class="badge bg-secondary rounded-pill">{{ completed_challenges }}</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span>–í—Å–µ–≥–æ –¥–Ω–µ–π:</span>
                        <span class="badge bg-info rounded-pill">{{ total_days_completed }}</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="col-md-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">–ú–æ–∏ —á–µ–ª–ª–µ–Ω–¥–∂–∏</h5>
                <a href="{% url 'challenge_list' %}" class="btn btn-sm btn-outline-primary">
                    + –ù–æ–≤—ã–π —á–µ–ª–ª–µ–Ω–¥–∂
                </a>
            </div>
            <div class="card-body">
                {% if user_challenges %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                    <th>–ù–∞—á–∞–ª–æ</th>
                                    <th>–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for challenge in user_challenges %}
                                <tr>
                                    <td>
                                        <strong>{{ challenge.title|truncatechars:25 }}</strong>
                                        <div class="small text-muted">{{ challenge.duration_days }} –¥–Ω–µ–π</div>
                                    </td>
                                    <td>
                                        {% with cat=challenge.category %}
                                        {% if cat == "sport" %}
                                        <span class="badge bg-primary">–°–ø–æ—Ä—Ç</span>
                                        {% elif cat == "creative" %}
                                        <span class="badge bg-success">–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ</span>
                                        {% elif cat == "study" %}
                                        <span class="badge bg-info">–û–±—É—á–µ–Ω–∏–µ</span>
                                        {% elif cat == "health" %}
                                        <span class="badge bg-warning text-dark">–ó–¥–æ—Ä–æ–≤—å–µ</span>
                                        {% elif cat == "productivity" %}
                                        <span class="badge bg-danger">–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</span>
                                        {% else %}
                                        <span class="badge bg-secondary">–î—Ä—É–≥–æ–µ</span>
                                        {% endif %}
                                        {% endwith %}
                                    </td>
                                    <td>{{ challenge.start_date|date:"d.m.Y" }}</td>
                                    <td>
                                        <div class="progress" style="height: 10px;">
                                            <div class="progress-bar bg-success" 
                                                style="width: 50%">
                                            </div>
                                        </div>
                                        <small class="text-muted">50%</small>
                                    </td>
                                    <td>
                                        {% if challenge.status == 'active' %}
                                            <span class="badge bg-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                        {% elif challenge.status == 'completed' %}
                                            <span class="badge bg-secondary">–ó–∞–≤–µ—Ä—à–µ–Ω</span>
                                        {% elif challenge.status == 'failed' %}
                                            <span class="badge bg-danger">–ü—Ä–æ–≤–∞–ª–µ–Ω</span>
                                        {% else %}
                                            <span class="badge bg-warning text-dark">–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <a href="{% url 'daily_checkin' challenge.id %}" class="btn btn-outline-primary">
                                                üìù –û—Ç–º–µ—Ç–∏—Ç—å
                                            </a>
                                            <a href="{% url 'challenge_calendar' challenge.id %}" class="btn btn-outline-info btn-sm">
                                                üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å
                                            </a>
                                            <a href="{% url 'complete_challenge' challenge.id %}" class="btn btn-outline-warning">
                                                ‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <div class="fs-1 mb-3">üéØ</div>
                        <h5>–£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç —á–µ–ª–ª–µ–Ω–¥–∂–µ–π</h5>
                        <p class="text-muted mb-4">–ù–∞—á–Ω–∏—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π —á–µ–ª–ª–µ–Ω–¥–∂ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!</p>
                        <a href="{% url 'challenge_list' %}" class="btn btn-primary btn-lg">
                            –í—ã–±—Ä–∞—Ç—å —á–µ–ª–ª–µ–Ω–¥–∂
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-body">
                <h6>üí° –°–æ–≤–µ—Ç—ã –¥–ª—è —É—Å–ø–µ—Ö–∞</h6>
                <div class="row">
                    <div class="col-md-6">
                        <ul class="small">
                            <li class="mb-2">–ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –æ–¥–Ω–æ–≥–æ —á–µ–ª–ª–µ–Ω–¥–∂–∞</li>
                            <li class="mb-2">–°—Ç–∞–≤—å—Ç–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ü–µ–ª–∏</li>
                            <li>–û—Ç–º–µ—á–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –µ–∂–µ–¥–Ω–µ–≤–Ω–æ</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul class="small">
                            <li class="mb-2">–ù–µ –±–æ–π—Ç–µ—Å—å –ø—Ä–æ–ø—É—Å–∫–æ–≤</li>
                            <li class="mb-2">–î–µ–ª–∏—Ç–µ—Å—å —É—Å–ø–µ—Ö–∞–º–∏</li>
                            <li>–ù–∞–≥—Ä–∞–∂–¥–∞–π—Ç–µ —Å–µ–±—è –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}