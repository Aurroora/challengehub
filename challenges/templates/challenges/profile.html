{% extends 'challenges/base.html' %}

{% block title %}ChallengeHub - –ü—Ä–æ—Ñ–∏–ª—å{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-3">
                <div>
                    <h1 class="mb-1">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
                    <p class="text-muted mb-0">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}!</p>
                </div>
                <div class="d-flex gap-3">
                    <a href="{% url 'overall_stats' %}" class="btn btn-info btn-custom px-4 py-3">
                        –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                    </a>
                    <a href="{% url 'challenge_list' %}" class="btn btn-primary btn-custom px-4 py-3">
                        + –ù–æ–≤—ã–π —á–µ–ª–ª–µ–Ω–¥–∂
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div class="row mb-5">
        <div class="col-md-8">
            <div class="card stat-card h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-4 mb-3">
                            <div class="p-3 rounded-3" style="background-color: #e3f2fd;">
                                <div class="fs-1 fw-bold text-primary">{{ user_challenges.count }}</div>
                                <div class="text-muted">–í—Å–µ–≥–æ —á–µ–ª–ª–µ–Ω–¥–∂–µ–π</div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="p-3 rounded-3" style="background-color: #e8f5e9;">
                                <div class="fs-1 fw-bold text-success">{{ active_challenges }}</div>
                                <div class="text-muted">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="p-3 rounded-3" style="background-color: #f3e5f5;">
                                <div class="fs-1 fw-bold text-secondary">{{ completed_challenges }}</div>
                                <div class="text-muted">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card stat-card h-100">
                <div class="card-header bg-info text-white">
                    <h5 class="card-title mb-0">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="id_username" class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                            <input type="text" name="username" value="{{ user.username }}" class="form-control" id="id_username" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="id_email" class="form-label">Email</label>
                            <input type="email" name="email" value="{{ user.email|default:'' }}" class="form-control" id="id_email">
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-custom">–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card stat-card">
                <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">–ú–æ–∏ —á–µ–ª–ª–µ–Ω–¥–∂–∏</h5>
                    <span class="badge bg-light text-dark fs-6">{{ user_challenges.count }} –≤—Å–µ–≥–æ</span>
                </div>
                <div class="card-body">
                    {% if user_challenges %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                        <th>–ù–∞—á–∞–ª–æ</th>
                                        <th>–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for challenge in user_challenges %}
                                    <tr class="align-middle {% if challenge.status != 'active' %}table-light{% endif %}">
                                        <td>
                                            <strong>{{ challenge.title|truncatechars:25 }}</strong>
                                            <div class="small text-muted">{{ challenge.duration_days }} –¥–Ω–µ–π</div>
                                        </td>
                                        <td>
                                            {% with cat=challenge.category %}
                                            {% if cat == "sport" %}
                                            <span class="badge bg-primary">üèÉ –°–ø–æ—Ä—Ç</span>
                                            {% elif cat == "creative" %}
                                            <span class="badge bg-success">üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ</span>
                                            {% elif cat == "study" %}
                                            <span class="badge bg-info">üìö –û–±—É—á–µ–Ω–∏–µ</span>
                                            {% elif cat == "health" %}
                                            <span class="badge bg-warning text-dark">üíä –ó–¥–æ—Ä–æ–≤—å–µ</span>
                                            {% elif cat == "productivity" %}
                                            <span class="badge bg-danger">‚ö° –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</span>
                                            {% else %}
                                            <span class="badge bg-secondary">üìå –î—Ä—É–≥–æ–µ</span>
                                            {% endif %}
                                            {% endwith %}
                                        </td>
                                        <td>{{ challenge.start_date|date:"d.m.Y" }}</td>
                                        <td>
                                            {% with progress=challenge.display_progress_percentage|default:0 %}
                                            <div class="d-flex flex-column align-items-start">
                                                <div class="fw-bold" style="font-size: 1.1rem;">
                                                    {% if challenge.days_passed > 0 %}
                                                        {{ progress|floatformat:0 }}%
                                                    {% else %}
                                                        <span class="text-muted">–ï—â–µ –Ω–µ –Ω–∞—á–∞—Ç</span>
                                                    {% endif %}
                                                </div>
                                                <small class="text-muted">
                                                    {{ challenge.completed_days }}/{{ challenge.duration_days }} –¥–Ω–µ–π
                                                </small>
                                            </div>
                                            {% endwith %}
                                        </td>
                                        <td>
                                            {% if challenge.status == 'active' %}
                                                <span class="badge bg-success rounded-pill">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                            {% elif challenge.status == 'completed' %}
                                                <span class="badge bg-secondary rounded-pill">–ó–∞–≤–µ—Ä—à–µ–Ω</span>
                                            {% elif challenge.status == 'failed' %}
                                                <span class="badge bg-danger rounded-pill">–ü—Ä–æ–≤–∞–ª–µ–Ω</span>
                                            {% else %}
                                                <span class="badge bg-warning text-dark rounded-pill">–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="btn-group">
                                                {% if challenge.status == 'active' %}
                                                    <a href="{% url 'daily_checkin' challenge.id %}" class="btn btn-primary btn-sm btn-custom">
                                                        –û—Ç–º–µ—Ç–∏—Ç—å
                                                    </a>
                                                    <a href="{% url 'complete_challenge' challenge.id %}" class="btn btn-warning btn-sm btn-custom">
                                                        –ó–∞–≤–µ—Ä—à–∏—Ç—å
                                                    </a>
                                                    <a href="{% url 'challenge_calendar' challenge.id %}" class="btn btn-info btn-sm btn-custom">
                                                        –ö–∞–ª–µ–Ω–¥–∞—Ä—å
                                                    </a>
                                                    <a href="{% url 'challenge_stats' challenge.id %}" class="btn btn-success btn-sm btn-custom">
                                                        –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
                                                    </a>
                                                {% else %}
                                                    <a href="{% url 'challenge_calendar' challenge.id %}" class="btn btn-outline-secondary btn-sm btn-custom">
                                                        –ò—Å—Ç–æ—Ä–∏—è
                                                    </a>
                                                    <a href="{% url 'challenge_stats' challenge.id %}" class="btn btn-outline-info btn-sm btn-custom">
                                                        –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                                                    </a>
                                                {% endif %}
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <div class="fs-1 mb-3">üéØ</div>
                            <h5>–£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç —á–µ–ª–ª–µ–Ω–¥–∂–µ–π</h5>
                            <p class="text-muted mb-4">–ù–∞—á–Ω–∏—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π —á–µ–ª–ª–µ–Ω–¥–∂ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!</p>
                            <a href="{% url 'challenge_list' %}" class="btn btn-primary btn-custom px-5 py-3">
                                –í—ã–±—Ä–∞—Ç—å —á–µ–ª–ª–µ–Ω–¥–∂
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="card stat-card mt-4">
                <div class="card-body">
                    <h6>–°–æ–≤–µ—Ç—ã –¥–ª—è —É—Å–ø–µ—Ö–∞</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="small">
                                <li class="mb-2">–ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –æ–¥–Ω–æ–≥–æ —á–µ–ª–ª–µ–Ω–¥–∂–∞</li>
                                <li class="mb-2">–°—Ç–∞–≤—å—Ç–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ü–µ–ª–∏</li>
                                <li>–û—Ç–º–µ—á–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –µ–∂–µ–¥–Ω–µ–≤–Ω–æ</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="small">
                                <li class="mb-2">–ù–µ –±–æ–π—Ç–µ—Å—å –ø—Ä–æ–ø—É—Å–∫–æ–≤</li>
                                <li class="mb-2">–î–µ–ª–∏—Ç–µ—Å—å —É—Å–ø–µ—Ö–∞–º–∏</li>
                                <li>–ù–∞–≥—Ä–∞–∂–¥–∞–π—Ç–µ —Å–µ–±—è –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.table th {
    font-weight: 600;
    background-color: #f8f9fa;
}

.table td {
    vertical-align: middle;
}

.progress {
    min-width: 120px;
}

.btn-group .btn-sm {
    padding: 6px 12px;
    font-size: 0.875rem;
}

.table-responsive {
    overflow-x: auto;
    max-width: 100%;
}

@media (max-width: 768px) {
    .btn-group {
        flex-wrap: wrap;
        gap: 5px;
    }
    
    .btn-group .btn-sm {
        margin-bottom: 5px;
    }
    
    .progress {
        width: 100px;
    }
}
</style>
{% endblock %}