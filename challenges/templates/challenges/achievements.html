{% extends 'challenges/base.html' %}

{% block title %}ChallengeHub - –ú–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è{% endblock %}

{% block content %}
<div class="container">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'profile' %}">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
            <li class="breadcrumb-item active">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</li>
        </ol>
    </nav>
    
    <div class="card mb-4">
        <div class="card-header bg-warning text-dark">
            <h4 class="card-title mb-0">–ú–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h4>
        </div>
        <div class="card-body">
            <div class="row mb-4">
                <div class="col-md-4 mb-3">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <div class="fs-1 mb-3">üèÜ</div>
                            <h3>{{ total_achievements }}</h3>
                            <p class="card-text">–í—Å–µ–≥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <div class="fs-1 mb-3">‚úÖ</div>
                            <h3>{{ completed_achievements }}</h3>
                            <p class="card-text">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <div class="fs-1 mb-3">üìä</div>
                            <h3>{{ completion_rate|floatformat:0 }}%</h3>
                            <p class="card-text">–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</p>
                        </div>
                    </div>
                </div>
            </div>
            
            {% for type, type_achievements in achievements_by_type.items %}
            <h5 class="mt-4 mb-3">
                {% if type == 'streak' %}–°–µ—Ä–∏–∏ –¥–Ω–µ–π
                {% elif type == 'completion' %}–ó–∞–≤–µ—Ä—à–µ–Ω–∏—è
                {% elif type == 'consistency' %}–†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å
                {% elif type == 'variety' %}–†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ
                {% endif %}
            </h5>
            
            <div class="row">
                {% for achievement in type_achievements %}
                <div class="col-md-6 col-lg-4 mb-3">
                    <div class="card h-100 {% if achievement.is_completed %}border-success{% else %}border-light{% endif %}">
                        <div class="card-body">
                            <div class="d-flex align-items-start mb-3">
                                <div class="fs-2 me-3">{{ achievement.icon }}</div>
                                <div>
                                    <h6 class="card-title mb-1">{{ achievement.title }}</h6>
                                    <p class="small text-muted mb-0">{{ achievement.description }}</p>
                                </div>
                            </div>
                            
                            {% if not achievement.is_completed %}
                            <div class="progress mb-2" style="height: 8px;">
                                <div class="progress-bar" 
                                     data-progress="{{ achievement.progress_percentage }}"
                                     style="width: 0%;">
                                </div>
                            </div>
                            <div class="small text-muted text-center">
                                {{ achievement.progress }} / {{ achievement.target }}
                            </div>
                            {% else %}
                            <div class="text-center text-success">
                                <small>‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ {{ achievement.earned_date|date:"d.m.Y" }}</small>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endfor %}
            
            {% if not achievements %}
            <div class="text-center py-5">
                <div class="fs-1 mb-3">üèÜ</div>
                <h5>–î–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</h5>
                <p class="text-muted mb-4">–ù–∞—á–∏–Ω–∞–π—Ç–µ —á–µ–ª–ª–µ–Ω–¥–∂–∏ –∏ –æ—Ç–º–µ—á–∞–π—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è!</p>
                <a href="{% url 'challenge_list' %}" class="btn btn-primary btn-custom">
                    –ù–∞—á–∞—Ç—å —á–µ–ª–ª–µ–Ω–¥–∂
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
    const progressBars = document.querySelectorAll('.progress-bar[data-progress]');
    progressBars.forEach(bar => {
        const progress = bar.getAttribute('data-progress');
        setTimeout(() => {
            bar.style.width = progress + '%';
        }, 300);
    });
    
    // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫
    const cards = document.querySelectorAll('.card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        setTimeout(() => {
            card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
});
</script>
{% endblock %}